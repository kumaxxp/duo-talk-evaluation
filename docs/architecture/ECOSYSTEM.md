# duo-talk-ecosystem ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³

**Document ID**: ARCH-001  
**Version**: 1.0.0  
**Last Updated**: 2026-01-30  
**Status**: Active  

---

## 1. ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“åƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         duo-talk-ecosystem                                   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      Dialogue Generation Layer                       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚    â”‚
â”‚  â”‚  â”‚    duo-talk-core      â”‚â—„â”€â”€â”€â”€â–ºâ”‚   duo-talk-director   â”‚          â”‚    â”‚
â”‚  â”‚  â”‚    v1.0.0             â”‚      â”‚      v1.0.0           â”‚          â”‚    â”‚
â”‚  â”‚  â”‚                       â”‚      â”‚                       â”‚          â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Character          â”‚      â”‚  â€¢ DirectorMinimal    â”‚          â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ PromptEngine       â”‚      â”‚  â€¢ DirectorHybrid     â”‚          â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ TwoPhaseEngine     â”‚      â”‚  â€¢ RAG Manager        â”‚          â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ DialogueManager    â”‚      â”‚  â€¢ StateExtractor     â”‚          â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ LLMClient          â”‚      â”‚  â€¢ Checkers           â”‚          â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                    â”‚                                         â”‚
â”‚                                    â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                        World Management Layer                        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚    â”‚
â”‚  â”‚  â”‚                      duo-talk-gm                           â”‚      â”‚    â”‚
â”‚  â”‚  â”‚                        v0.1.0                              â”‚      â”‚    â”‚
â”‚  â”‚  â”‚                                                            â”‚      â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ WorldState      â€¢ ActionJudge      â€¢ FactGenerator     â”‚      â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Preflight       â€¢ OutputParser     â€¢ StallDetector     â”‚      â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ ActionNormalizer                                        â”‚      â”‚    â”‚
â”‚  â”‚  â”‚                                                            â”‚      â”‚    â”‚
â”‚  â”‚  â”‚  [FastAPI REST API - Port 8001]                           â”‚      â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                    â”‚                                         â”‚
â”‚                                    â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                     Evaluation & Command Layer                       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚    â”‚
â”‚  â”‚  â”‚              duo-talk-evaluation  âš“ FLAGSHIP               â”‚      â”‚    â”‚
â”‚  â”‚  â”‚                        v0.1.0                              â”‚      â”‚    â”‚
â”‚  â”‚  â”‚                                                            â”‚      â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ GeminiEvaluator    â€¢ HAKONIWAEngine   â€¢ A/B Framework  â”‚      â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ SemanticMatcher    â€¢ NiceGUI          â€¢ Scenario Ops   â”‚      â”‚    â”‚
â”‚  â”‚  â”‚                                                            â”‚      â”‚    â”‚
â”‚  â”‚  â”‚  [Documentation HQ]                                        â”‚      â”‚    â”‚
â”‚  â”‚  â”‚    docs/strategy/   docs/rules/   docs/architecture/      â”‚      â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ãƒªãƒã‚¸ãƒˆãƒªè©³ç´°

### 2.1 duo-talk-core

**å½¹å‰²**: ç´”ç²‹ãªå¯¾è©±ç”Ÿæˆã‚¨ãƒ³ã‚¸ãƒ³

```
duo-talk-core/
â”œâ”€â”€ src/duo_talk_core/
â”‚   â”œâ”€â”€ character.py           # ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å®šç¾©
â”‚   â”œâ”€â”€ character_loader.py    # YAMLè¨­å®šèª­ã¿è¾¼ã¿
â”‚   â”œâ”€â”€ dialogue_manager.py    # å¯¾è©±ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
â”‚   â”œâ”€â”€ llm_client.py          # LLMãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æŠ½è±¡åŒ–
â”‚   â”œâ”€â”€ prompt_engine.py       # v3.8.1 ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
â”‚   â”œâ”€â”€ prompt_loader.py       # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆèª­ã¿è¾¼ã¿
â”‚   â”œâ”€â”€ two_pass_generator.py  # 2ãƒ‘ã‚¹ç”Ÿæˆ
â”‚   â”œâ”€â”€ two_phase_engine.py    # Thoughtâ†’Outputåˆ†é›¢ç”Ÿæˆ
â”‚   â””â”€â”€ prompts/
â”‚       â”œâ”€â”€ anchors.yaml
â”‚       â”œâ”€â”€ few_shots_speaker.yaml
â”‚       â””â”€â”€ few_shots_thinker.yaml
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ yana.yaml              # ã‚„ãªè¨­å®š
â”‚   â””â”€â”€ ayu.yaml               # ã‚ã‚†è¨­å®š
â””â”€â”€ tests/
```

**ä¾å­˜é–¢ä¿‚**:
- `pyyaml>=6.0`
- `httpx>=0.27.0`

**å¤–éƒ¨æ¥ç¶š**:
- Ollama (port 11434)
- KoboldCPP (optional)

---

### 2.2 duo-talk-director

**å½¹å‰²**: å¯¾è©±å“è³ªã®ç›£è¦–ãƒ»æ¼”å‡ºãƒ»RAGç®¡ç†

```
duo-talk-director/
â”œâ”€â”€ src/duo_talk_director/
â”‚   â”œâ”€â”€ director_minimal.py    # é™çš„ãƒã‚§ãƒƒã‚¯ã®ã¿ (<200ms)
â”‚   â”œâ”€â”€ director_hybrid.py     # é™çš„ + LLM + RAG
â”‚   â”œâ”€â”€ director_llm.py        # LLMã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°
â”‚   â”œâ”€â”€ interfaces.py          # Protocolå®šç¾©
â”‚   â”œâ”€â”€ checks/
â”‚   â”‚   â”œâ”€â”€ action_sanitizer.py
â”‚   â”‚   â”œâ”€â”€ context_check.py
â”‚   â”‚   â”œâ”€â”€ format_check.py
â”‚   â”‚   â”œâ”€â”€ praise_check.py
â”‚   â”‚   â”œâ”€â”€ setting_check.py
â”‚   â”‚   â”œâ”€â”€ thought_check.py
â”‚   â”‚   â””â”€â”€ tone_check.py
â”‚   â”œâ”€â”€ rag/
â”‚   â”‚   â”œâ”€â”€ fact_card.py
â”‚   â”‚   â”œâ”€â”€ persona_rag.py
â”‚   â”‚   â”œâ”€â”€ rag_manager.py
â”‚   â”‚   â””â”€â”€ session_rag.py
â”‚   â”œâ”€â”€ state/
â”‚   â”‚   â”œâ”€â”€ extractor.py
â”‚   â”‚   â”œâ”€â”€ models.py
â”‚   â”‚   â””â”€â”€ signals.py
â”‚   â”œâ”€â”€ logging/
â”‚   â”‚   â”œâ”€â”€ log_store.py
â”‚   â”‚   â”œâ”€â”€ sanitizer_logger.py
â”‚   â”‚   â””â”€â”€ thought_logger.py
â”‚   â””â”€â”€ config/
â”‚       â”œâ”€â”€ persona_rules.yaml
â”‚       â””â”€â”€ thresholds.py
â””â”€â”€ tests/
```

**ä¾å­˜é–¢ä¿‚**:
- ãªã—ï¼ˆè»½é‡è¨­è¨ˆï¼‰
- Optional: `duo-talk-core`

---

### 2.3 duo-talk-gm

**å½¹å‰²**: ã‚²ãƒ¼ãƒ ãƒã‚¹ã‚¿ãƒ¼ï¼ˆä¸–ç•ŒçŠ¶æ…‹ç®¡ç†ãƒ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³åˆ¤å®šï¼‰

```
duo-talk-gm/
â”œâ”€â”€ src/duo_talk_gm/
â”‚   â”œâ”€â”€ main.py                # FastAPIã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ gm_step.py         # /step ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ action_judge.py    # ã‚¢ã‚¯ã‚·ãƒ§ãƒ³åˆ¤å®š
â”‚   â”‚   â”œâ”€â”€ action_normalizer.py
â”‚   â”‚   â”œâ”€â”€ fact_generator.py  # ãƒ•ã‚¡ã‚¯ãƒˆç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ output_parser.py   # å‡ºåŠ›ãƒ‘ãƒ¼ã‚¹
â”‚   â”‚   â”œâ”€â”€ preflight.py       # äº‹å‰ãƒã‚§ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ prompts.py
â”‚   â”‚   â”œâ”€â”€ stall_detector.py  # åœæ»æ¤œå‡º
â”‚   â”‚   â””â”€â”€ world_updater.py   # ä¸–ç•ŒçŠ¶æ…‹æ›´æ–°
â”‚   â””â”€â”€ models/
â”‚       â”œâ”€â”€ enums.py
â”‚       â”œâ”€â”€ gm_response.py
â”‚       â””â”€â”€ world_state.py
â””â”€â”€ tests/
```

**ä¾å­˜é–¢ä¿‚**:
- `fastapi>=0.109.0`
- `uvicorn[standard]>=0.27.0`
- `pydantic>=2.5.0`
- `jsonpatch>=1.33`
- `pyyaml>=6.0`

**API**:
- `POST /step` - 1ã‚¹ãƒ†ãƒƒãƒ—é€²è¡Œ
- `GET /health` - ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

---

### 2.4 duo-talk-evaluation âš“ (FLAGSHIP)

**å½¹å‰²**: çµ±åˆè©•ä¾¡ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãƒ»å¸ä»¤éƒ¨

```
duo-talk-evaluation/
â”œâ”€â”€ docs/                      # ğŸ“‹ å¸ä»¤éƒ¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ strategy/
â”‚   â”‚   â””â”€â”€ STRATEGY.md        # æˆ¦ç•¥æ–‡æ›¸
â”‚   â”œâ”€â”€ rules/
â”‚   â”‚   â””â”€â”€ RULES.md           # é–‹ç™ºãƒ«ãƒ¼ãƒ«
â”‚   â””â”€â”€ architecture/
â”‚       â””â”€â”€ ECOSYSTEM.md       # æœ¬æ–‡æ›¸
â”œâ”€â”€ specs/                     # æ©Ÿèƒ½ä»•æ§˜æ›¸
â”‚   â””â”€â”€ phases/
â”œâ”€â”€ experiments/               # å®Ÿé¨“ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ results/                   # å®Ÿé¨“çµæœï¼ˆ130+ï¼‰
â”œâ”€â”€ scenarios/                 # HAKONIWAã‚·ãƒŠãƒªã‚ª
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ evaluators/           # è©•ä¾¡ã‚¨ãƒ³ã‚¸ãƒ³
â”‚   â”œâ”€â”€ adapters/             # ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ€ãƒ—ã‚¿
â”‚   â””â”€â”€ ...
â”œâ”€â”€ gui_nicegui/              # NiceGUIå®Ÿè£…
â””â”€â”€ tests/
```

**ä¾å­˜é–¢ä¿‚**:
- `google-genai>=0.2.0`
- `pydantic>=2.0.0`
- `pyyaml>=6.0`
- `pandas>=2.0.0`
- `requests>=2.31.0`
- `click>=8.0.0`

---

## 3. ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡

### 3.1 é€šä¿¡æ–¹å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  duo-talk    â”‚   Python Import    â”‚   duo-talk       â”‚
â”‚    core      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚    director      â”‚
â”‚              â”‚   (åŒä¸€ãƒ—ãƒ­ã‚»ã‚¹)     â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                     â”‚
       â”‚ HTTP REST                           â”‚
       â”‚ (Port 8001)                         â”‚
       â–¼                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    duo-talk-gm                        â”‚
â”‚              [FastAPI Server]                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ HTTP REST / Python Import
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                duo-talk-evaluation                    â”‚
â”‚           [Test Runner / GUI Server]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è©³ç´°

```
[1] User Input (Topic)
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  core   â”‚ â† Character Config (YAML)
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
         â”‚ [2] Generate Thought (Phase 1)
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ director â”‚ â† RAG Facts (if enabled)
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ [3] Check Thought + Inject Facts
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  core   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
         â”‚ [4] Generate Output (Phase 2)
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ director â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ [5] Quality Check (Tone, Praise, Setting)
         â”‚
         â”œâ”€â”€â”€ PASS â”€â”€â–º Output to User
         â”‚
         â””â”€â”€â”€ RETRY â”€â–º Back to [2]
```

---

## 4. ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæ§‹æˆ

### 4.1 é–‹ç™ºç’°å¢ƒ

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     Developer Machine       â”‚
                    â”‚                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   Ollama    â”‚â—„â”€â”€â”€â”€â”¼â”€â”€â”¤  Python 3.11+ venv    â”‚  â”‚
â”‚ (Port 11434)â”‚     â”‚  â”‚                       â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚  â€¢ duo-talk-core      â”‚  â”‚
                    â”‚  â”‚  â€¢ duo-talk-director  â”‚  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚  â€¢ duo-talk-gm        â”‚  â”‚
â”‚  GM Server  â”‚â—„â”€â”€â”€â”€â”¼â”€â”€â”¤  â€¢ duo-talk-evaluationâ”‚  â”‚
â”‚ (Port 8001) â”‚     â”‚  â”‚                       â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â”‚                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                             â”‚
â”‚  GUI Server â”‚â—„â”€â”€â”€â”€â”¤                             â”‚
â”‚ (Port 8080) â”‚     â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 èµ·å‹•æ‰‹é †

```bash
# 1. Ollamaèµ·å‹•ï¼ˆåˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼‰
ollama serve

# 2. GM Serverèµ·å‹•ï¼ˆåˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼‰
cd duo-talk-gm
uvicorn duo_talk_gm.main:app --port 8001

# 3. GUIèµ·å‹•ï¼ˆãƒ¡ã‚¤ãƒ³ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼‰
cd duo-talk-evaluation
make gui
# â†’ http://localhost:8080
```

---

## 5. ä¾å­˜é–¢ä¿‚ãƒãƒˆãƒªãƒƒã‚¯ã‚¹

```
                  core    director    gm    evaluation
    core           -        â—‹         -         â—‹
    director       â—‹        -         -         â—‹
    gm             -        -         -         â—‹
    evaluation     -        -         -         -

    â—‹ = ä¾å­˜ã‚ã‚Šï¼ˆImport or API Callï¼‰
    - = ä¾å­˜ãªã—
```

### 5.1 å¤–éƒ¨ä¾å­˜

| Service | External Dependency | Purpose |
|:--------|:--------------------|:--------|
| core | Ollama / KoboldCPP | LLM Backend |
| director | (none) | - |
| gm | (none) | - |
| evaluation | Gemini API (optional) | External Evaluation |

---

## 6. æ‹¡å¼µãƒã‚¤ãƒ³ãƒˆ

### 6.1 æ–°ã—ã„ãƒã‚§ãƒƒã‚«ãƒ¼ã®è¿½åŠ 

```python
# duo-talk-director/src/duo_talk_director/checks/new_check.py

from ..interfaces import CheckProtocol, CheckResult, CheckStatus

class NewChecker(CheckProtocol):
    def check(self, output: str, context: dict) -> CheckResult:
        # å®Ÿè£…
        return CheckResult(status=CheckStatus.PASS, score=1.0)
```

### 6.2 æ–°ã—ã„è©•ä¾¡è»¸ã®è¿½åŠ 

```python
# duo-talk-evaluation/src/evaluators/new_evaluator.py

from .base import BaseEvaluator

class NewEvaluator(BaseEvaluator):
    def evaluate(self, dialogue: list[dict]) -> dict:
        # å®Ÿè£…
        return {"new_metric": 0.85}
```

### 6.3 æ–°ã—ã„ã‚·ãƒŠãƒªã‚ªã®è¿½åŠ 

```yaml
# duo-talk-evaluation/scenarios/new_scenario.yaml

id: new_scenario
name: "æ–°ã‚·ãƒŠãƒªã‚ª"
world:
  containers:
    - id: table
      name: ãƒ†ãƒ¼ãƒ–ãƒ«
  objects:
    - id: cup
      location: table
goal:
  type: object_found
  target: cup
```

---

## 7. Document Control

| Version | Date | Author | Changes |
|:--------|:-----|:-------|:--------|
| 1.0.0 | 2026-01-30 | HQ Staff | Initial creation |

---

*This document describes the architectural design of duo-talk-ecosystem.*  
*For strategic decisions, see [STRATEGY.md](../strategy/STRATEGY.md).*  
*For development rules, see [RULES.md](../rules/RULES.md).*
