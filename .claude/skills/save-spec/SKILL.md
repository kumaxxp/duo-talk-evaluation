---
name: save-spec
description: Gemini/ChatGPTなどから取得した情報をフェーズに合わせた仕様書として保存する。ユーザーがコピペした内容を整形してマークダウン化し、specs/ディレクトリに保存する。
---

# 仕様書保存スキル

ユーザーがGemini、ChatGPT、その他の情報源から取得した内容を、プロジェクトの仕様書として整形・保存します。

## 使用タイミング

- ユーザーが「Geminiからの情報」「ChatGPTの意見」「仕様として保存」などと言った時
- 技術的な情報や設計情報をコピペした時
- AIからの分析・提案・レビュー結果を受け取った時
- `/save-spec` コマンドを実行した時

## 情報源の種類

| 情報源 | 特徴 | 処理方針 |
|--------|------|---------|
| **Gemini** | 技術情報、API仕様、調査結果 | そのまま仕様化 |
| **ChatGPT** | 分析、提案、レビュー | **妥当性評価を追加** |
| **Web検索** | ドキュメント、記事 | 出典明記 |
| **ユーザー入力** | 要件、アイデア | 整形のみ |

## 実行手順

### 1. 情報の分類

ユーザーから提供された情報を以下のカテゴリに分類:

| カテゴリ | 保存先 | ファイル名規則 |
|---------|--------|---------------|
| フェーズ仕様 | `specs/phases/` | `PHASE{N}_{TOPIC}.md` |
| アーキテクチャ | `specs/architecture/` | `ARCH_{TOPIC}.md` |
| **提案・レビュー** | `specs/architecture/` | `ARCH_{SOURCE}_RECOMMENDATIONS_{DATE}.md` |
| 実験設計 | `specs/experiments/` | `EXP_{TOPIC}.md` |
| API仕様 | `specs/api/` | `API_{SERVICE}.md` |
| その他 | `specs/misc/` | `MISC_{TOPIC}.md` |

### 2. ファイル名の決定

```
例:
- Phase 2のDirector仕様 → specs/phases/PHASE2_DIRECTOR_SPEC.md
- Ollama APIの仕様 → specs/api/API_OLLAMA.md
- 評価メトリクスの設計 → specs/architecture/ARCH_EVALUATION_METRICS.md
```

### 3. 内容の整形

以下のテンプレートに従って整形:

```markdown
# 仕様書: {タイトル}

**文書ID**: {YYYYMMDD}_{連番}
**作成日**: {今日の日付}
**フェーズ**: {該当フェーズ}
**ステータス**: Draft / Review / Approved
**情報源**: Gemini / Web検索 / ユーザー入力 / その他

---

## 概要

{1-2文で要約}

---

## 背景と目的

{なぜこの仕様が必要か}

---

## 詳細仕様

{整形されたコンテンツ本体}

---

## 実装要件

{実装時に必要な要件があれば}

---

## 関連文書

- {関連する他の仕様書へのリンク}

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|---------|
| {今日} | 1.0 | 初版作成 |

---

*Source: {情報源}*
```

### 3.1 提案・レビュー用テンプレート（ChatGPT等）

AIからの分析・提案・レビュー結果には、**妥当性評価セクション**を追加:

```markdown
# 仕様書: {情報源}提案レビュー

**文書ID**: {YYYYMMDD}_{連番}
**作成日**: {今日の日付}
**フェーズ**: {該当フェーズ}
**ステータス**: Review
**情報源**: ChatGPT / Gemini / Claude / その他

---

## 概要

{提案内容の1-2文要約}

---

## 提案一覧

| # | 提案 | カテゴリ | 優先度 | 判定 |
|---|------|---------|--------|------|
| 1 | {提案1} | {カテゴリ} | 高/中/低 | 🟢採用 / 🟡検討 / 🔴保留 / ⚫却下 |
| 2 | {提案2} | ... | ... | ... |

---

## 提案{N}: {タイトル}

### {情報源}の意見

> {原文引用}

### 現状確認

| 項目 | 状態 |
|------|------|
| 実装 | ✅完了 / ⚡利用可能 / ❌未実装 |
| 効果検証 | ✅済 / ❓未検証 |

### 妥当性評価

| 観点 | 評価 | 理由 |
|------|------|------|
| 効果 | ⭐⭐⭐ / ⭐⭐ / ⭐ | {理由} |
| リスク | 高/中/低 | {理由} |
| 実装コスト | 高/中/低 | {理由} |
| 現行との整合性 | 問題なし / 要調整 | {理由} |

### 判定: 🟢採用 / 🟡検討 / 🔴保留 / ⚫却下

**理由**: {判定理由}

**実装方針** (採用の場合):
{具体的な実装方法}

---

## 現行計画との統合

{現行ロードマップとの整合性、変更案}

---

## 次のアクション

### 即座に実行
| アクション | 担当 | 優先度 |
|-----------|------|--------|
| ... | ... | 高/中/低 |

### 条件付き実行
| アクション | 条件 | 優先度 |
|-----------|------|--------|
| ... | {実行条件} | 高/中/低 |

### 保留
| アクション | 条件 | 優先度 |
|-----------|------|--------|
| ... | {再評価条件} | 低 |

---

*Source: {情報源}分析（{日付}）*
```

### 妥当性評価の観点

提案を評価する際は以下の観点で検討:

| 観点 | 評価基準 |
|------|---------|
| **効果** | 実験で確認済み(⭐⭐⭐) / 理論的に期待(⭐⭐) / 不明(⭐) |
| **リスク** | 既存機能への影響度 |
| **実装コスト** | 新規実装(高) / 修正(中) / 設定変更(低) |
| **現行との整合性** | 既存計画・アーキテクチャとの一致度 |
| **問題頻度** | 対象問題の発生頻度（計測が必要な場合は「要計測」） |

### 判定基準

| 判定 | 条件 |
|------|------|
| 🟢 **採用** | 効果検証済み、リスク低、実装コスト低 |
| 🟡 **検討** | 効果は期待できるが、追加調査/計測が必要 |
| 🔴 **保留** | 効果は高いが、先に他の施策を試すべき |
| ⚫ **却下** | 効果が低い、またはリスクが高すぎる |

### 4. コード・JSONの整形

情報にコードやJSONが含まれる場合:

- 適切な言語タグを付けてコードブロック化
- インデントを整える
- 必要に応じてコメントを追加

```python
# 例: Pythonコードの整形
def example_function():
    """ドキュメント文字列を追加"""
    pass
```

### 5. 保存と確認

1. ファイルを作成
2. 内容をユーザーに表示
3. 必要に応じて修正

## 出力フォーマット

### 通常の仕様書

保存完了後、以下を報告:

```
✅ 仕様書を保存しました

📄 ファイル: specs/phases/PHASE2_DIRECTOR_SPEC.md
📁 カテゴリ: フェーズ仕様
🏷️ タグ: Phase 2, Director, LLM評価

## 目次
1. 概要
2. 背景と目的
3. 詳細仕様
   - 3.1 サブセクション
   - 3.2 サブセクション
4. 実装要件
5. 関連文書
```

### 提案・レビュー（ChatGPT等）

提案を含む場合は**妥当性評価サマリー**を追加:

```
✅ 仕様書を保存しました

📄 ファイル: specs/architecture/ARCH_CHATGPT_RECOMMENDATIONS_20260124.md
📁 カテゴリ: 提案・レビュー
🏷️ タグ: ChatGPT, レビュー, 機能一覧

## 妥当性評価サマリー

| # | 提案 | 判定 | 理由 |
|---|------|------|------|
| 1 | {提案1} | 🟢採用 | {理由} |
| 2 | {提案2} | 🟡検討 | {理由} |
| 3 | {提案3} | 🔴保留 | {理由} |

## 現行計画への影響

{既存ロードマップとの統合案を簡潔に}
```

## 注意事項

- 機密情報（APIキー、パスワード等）は自動的に除去
- 既存ファイルがある場合は上書き確認
- UTF-8エンコーディングで保存
- 改行コードはLF統一

## 使用例

### 例1: Geminiからの技術情報

```
ユーザー: これはGeminiから取得したOllama APIの情報です
[コピペ内容]

Claude: /save-spec を実行します。

✅ 仕様書を保存しました
📄 ファイル: specs/api/API_OLLAMA.md
📁 カテゴリ: API仕様
🏷️ タグ: Ollama, API
```

### 例2: ChatGPTからの提案・レビュー

```
ユーザー: ChatGPTから機能一覧のレビュー結果です
[5つの提案を含むコピペ内容]

Claude: /save-spec を実行します。

ChatGPTからの提案を分析し、現行実装と照合します...

✅ 仕様書を保存しました
📄 ファイル: specs/architecture/ARCH_CHATGPT_RECOMMENDATIONS_20260124.md
📁 カテゴリ: 提案・レビュー
🏷️ タグ: ChatGPT, レビュー, 提案

## 妥当性評価サマリー

| # | 提案 | 判定 | 理由 |
|---|------|------|------|
| 1 | TWO_PASSデフォルト化 | 🟢採用 | 88%改善確認済み |
| 2 | Director使い分け | 🟢採用 | 現状と一致 |
| 3 | ActionWhitelistChecker | 🟡検討 | 問題頻度要計測 |
| 4 | 3段階アーキテクチャ | 🔴保留 | TWO_PASS先行 |
| 5 | TWO_PASS vs Two-Phase比較 | 🟢採用 | 両方実装済み |
```

### 例3: 複数AIの意見統合

```
ユーザー: GeminiとChatGPTから別々に意見をもらいました。統合してください。
[Geminiの意見]
[ChatGPTの意見]

Claude: 両方の意見を統合して仕様化します...

✅ 仕様書を保存しました
📄 ファイル: specs/architecture/ARCH_AI_CONSENSUS_20260124.md
📁 カテゴリ: 提案・レビュー
🏷️ タグ: Gemini, ChatGPT, 統合レビュー
```
