# duo-talk-ecosystem スコープ境界線

**文書ID**: 20260124_005
**作成日**: 2026-01-24
**ステータス**: Draft
**目的**: 過設計・過学習を防ぐための「やらないこと」の明文化

---

## 概要

duo-talk-ecosystemの開発において、**何をやらないか**を明確に定義する。
これにより、フォーカスを維持し、過度な複雑化を防ぐ。

---

## 基本原則

### 1. 会話エンジンに集中する

> **今はまだ「会話エンジンを磨くフェーズ」**

物語生成、イベント進行、世界構築は後回し。
まずは2人のキャラクターが自然に会話できることに集中。

### 2. 最小限で機能するものを選ぶ

> **動くものが正義。完璧を目指さない。**

- 80%の品質で100%動く > 100%の品質で80%動く
- 実験で検証してから拡張

### 3. ユーザー体験を最優先

> **没入感を壊すものは排除。技術的正しさより体験。**

- RETRYより削除して通す
- 警告より自動修正

### 4. 壊れてたら"直す"より"落とす"

> **自動修正で"キャラの意図"を変えるとユーザーは一発で気付く。**
> **自動修正で"行動"を消すのは気づきにくい。**

- 修正は局所に限る（Actionだけ、フォーマットだけ）
- 意味内容（台詞の意図）には触らない
- 直せないときは潔く落とす（行動削除、台詞のみ採用）

---

## Phase 2 の境界線

### ✅ やること（確定済み）

| 項目 | 状態 | 理由 |
|------|:----:|------|
| TWO_PASS生成モード | ✅ 完了 | フォーマット成功率100% |
| DirectorMinimal（本番） | ✅ 完了 | 高速な静的チェック |
| DirectorHybrid（評価用） | ✅ 完了 | 失敗収集器として |
| ActionSanitizer軽量版 | ✅ 完了 | Props削除で通す |
| StateExtractor v1.0 | ✅ 完了 | シグナル検出型 |
| ToneChecker v2.2 | ✅ 完了 | Output部分のみ |
| CI/CD整備 | ✅ 完了 | 758テスト |
| 回帰ミニベンチ | 🔜 Phase 2.3 | 壊れてない確認 |

### 🔜 Phase 2.3 でやること

| 項目 | 目的 |
|------|------|
| 回帰テスト（ミニベンチ） | 「壊れてない」の確認 |
| ActionSanitizerログ蓄積 | 削除/置換パターン把握 |
| Thoughtログ蓄積 | 一貫性・感情遷移の観測 |

回帰テスト指標:
- format_success_rate
- thought_missing_rate
- avg_retries
- action_sanitized_rate

### ❌ やらないこと（Phase 2）

| 項目 | 理由 | 代替案 |
|------|------|--------|
| **高度なState Updater** | ログ蓄積が先 | StateExtractorで十分 |
| **行動生成専用LLM** | TWO_PASS+Scene制約で十分 | ActionSanitizerで対応 |
| **多エージェント構成** | 過設計リスク | 単一LLMで継続 |
| **RAG統合** | Phase 3の範囲 | 会話エンジン優先 |
| **小説向きAI混合** | スコープ外 | Phase 3以降で検討 |
| **物語生成機能** | スコープ外 | 会話に集中 |
| **高度な知能化** | 過学習リスク | 観測に徹する |

---

## Director の境界線

### DirectorMinimal

| やること | やらないこと |
|----------|-------------|
| 静的パターンマッチ | LLM評価 |
| フォーマットチェック | 品質スコアリング |
| 禁止語検出 | 意味理解 |
| 即座にPASS/RETRY判定 | 複雑な条件分岐 |

### DirectorHybrid

| やること | やらないこと |
|----------|-------------|
| 失敗パターン収集 | 本番リアルタイム処理 |
| 5軸評価スコア計算 | 生成への介入 |
| CI/夜間バッチ評価 | ユーザー向け表示 |
| ログ蓄積 | 動的学習 |

### Director全般

> **Directorは「品質向上装置」ではなく「安全装置・観測装置」**

- ❌ 賢い監督にしない
- ✅ ログを集める地味な観測者にする

---

## StateExtractor の境界線

### やること

| 項目 | 方法 |
|------|------|
| 感情検出 | シグナル辞書マッチ |
| 関係性トーン検出 | シグナル辞書マッチ |
| 感情変化追跡 | 差分計算 |
| 信頼度計算 | シグナル数ベース |

### やらないこと

| 項目 | 理由 | 将来検討 |
|------|------|---------|
| LLM統合 | 速度優先 | Phase 3以降 |
| セッションレベル状態 | 複雑化 | ログ蓄積後 |
| 感情予測 | 過設計 | 不要 |
| 自動学習 | 過学習リスク | 不要 |

---

## ActionSanitizer の境界線

### やること

| 項目 | 方法 |
|------|------|
| Props検出 | 辞書マッチ |
| Action削除 | 正規表現置換 |
| フォールバック置換 | 辞書参照 |
| ログ記録 | blocked_props保存 |

### やらないこと

| 項目 | 理由 |
|------|------|
| RETRY要求 | ユーザー体験優先 |
| Scene生成 | スコープ外 |
| Props自動生成 | 過設計 |
| 文脈理解 | 速度優先 |

---

## 生成モード の境界線

### TWO_PASS（本番）

| やること | やらないこと |
|----------|-------------|
| Thought生成 | 複数候補生成 |
| Output生成 | 自動リライト |
| max_tokens制限 | 動的調整 |

### Two-Phase（実験用）

| やること | やらないこと |
|----------|-------------|
| 隔離実験 | 本番利用 |
| State抽出テスト | 品質評価 |
| 比較実験 | 統合 |

---

## 技術選択 の境界線

### 使う技術

| 技術 | 用途 |
|------|------|
| Ollama + gemma3:12b | 本番LLM |
| Python 3.11 | 言語 |
| pytest | テスト |
| 正規表現 | パターンマッチ |
| 辞書ベース検出 | 状態抽出 |

### 使わない技術（Phase 2）

| 技術 | 理由 | 将来 |
|------|------|------|
| 形態素解析 | 速度低下 | Phase 3で検討可 |
| 機械学習モデル | 過設計 | 不要 |
| 外部NLPサービス | 依存増加 | 不要 |
| 複数LLMオーケストレーション | 複雑化 | 不要 |
| リアルタイムファインチューニング | 不要 | 不要 |

> **注**: 形態素解析はActionSanitizer強化時に必要になる可能性があるため、「永遠にやらない」ではなくPhase 3で解禁可能。

---

## 品質目標 の境界線

### 目指す品質

| 指標 | 目標 | 理由 |
|------|------|------|
| フォーマット成功率 | 100% | 必須 |
| テストカバレッジ | 80%以上 | 十分 |
| リトライ率 | 5%以下 | 体験維持 |

### 目指さない品質

| 指標 | 理由 |
|------|------|
| 完璧なキャラ一貫性 | 過学習リスク |
| 100%自然な会話 | 不可能 |
| 人間レベルの理解 | スコープ外 |

---

## Phase 3 以降の検討事項

以下はPhase 3以降で**検討のみ**行う:

| 項目 | 条件 |
|------|------|
| RAG統合 | 会話エンジン安定後 |
| StateExtractor LLM統合 | ログ分析で必要性確認後 |
| 物語生成 | 需要があれば |
| 多エージェント | 明確な要件があれば |

---

## 判断フローチャート

新機能追加の判断:

```
1. 会話エンジンの品質向上に直接貢献するか？
   → NO → やらない

2. 最小限の実装で動作するか？
   → NO → やらない（または簡略化）

3. ユーザー体験を改善するか？
   → NO → やらない

4. 既存テストを壊さないか？
   → NO → 慎重に検討

5. Phase 2のスコープ内か？
   → NO → Phase 3以降に延期
```

---

## 合意事項

この文書で定義された境界線は、以下の条件まで有効:

1. Phase 2完了まで
2. 明示的なスコープ変更の合意があるまで
3. 重大な技術的問題が発生するまで

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|---------|
| 2026-01-24 | 1.0 | 初版作成 |

---

*このドキュメントは過設計・過学習を防ぐための指針です*
