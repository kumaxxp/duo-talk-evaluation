# 仕様書: ChatGPT機能一覧レビュー提案

**文書ID**: 20260124_002
**作成日**: 2026-01-24
**フェーズ**: Phase 2.3 / 最適化
**ステータス**: Review
**情報源**: ChatGPT分析

---

## 概要

duo-talk-ecosystemの機能一覧に対するChatGPTのレビュー結果と5つの改善提案。各提案の妥当性を現行実装と照合し、採用/保留/却下を判断する。

---

## 提案一覧

| # | 提案 | カテゴリ | 優先度 | 判定 |
|---|------|---------|--------|------|
| 1 | TWO_PASSをデフォルト化 | 最適化 | 高 | 🟢 採用 |
| 2 | Director使い分け戦略 | 最適化 | 中 | 🟢 採用 |
| 3 | ActionWhitelistChecker追加 | 新機能 | 中 | 🟡 検討 |
| 4 | 3段階アーキテクチャ | 設計変更 | 低 | 🔴 保留 |
| 5 | TWO_PASS vs Two-Phase比較 | 検証 | 中 | 🟢 採用 |

---

## 提案1: TWO_PASSをデフォルト化

### ChatGPTの意見

> TWO_PASSを「実質デフォルト」に固定し、もう切り替えで悩む必要をなくす

### 現状確認

| 項目 | 状態 |
|------|------|
| 実装 | ✅ 完了 (`GenerationMode.TWO_PASS`) |
| デフォルト | ONE_PASS |
| 効果検証 | ✅ 88%のフォーマット違反減少（2026-01-24実験） |

### 妥当性評価

| 観点 | 評価 | 理由 |
|------|------|------|
| 効果 | ⭐⭐⭐ | 実験で大幅改善を確認済み |
| リスク | 低 | LLM呼び出し2回になるが許容範囲 |
| 実装コスト | 低 | デフォルト値変更のみ |
| 互換性 | 問題なし | ONE_PASSも引き続き利用可能 |

### 判定: 🟢 採用

**理由**: 効果検証済み、実装コスト低、リスク低

**実装方針**:
```python
# duo-talk-core/dialogue_manager.py
def __init__(self, ..., generation_mode=GenerationMode.TWO_PASS):  # デフォルト変更
```

---

## 提案2: Director使い分け戦略

### ChatGPTの意見

> - 本番: DirectorMinimal（高速、必要十分）
> - 評価・実験: DirectorHybrid（詳細分析）

### 現状確認

| Director | 状態 | 用途 |
|----------|------|------|
| DirectorMinimal | ✅ デフォルト | 静的チェックのみ（高速） |
| DirectorHybrid | ⚡ 利用可能 | 静的+LLM評価（詳細） |

### 妥当性評価

| 観点 | 評価 | 理由 |
|------|------|------|
| 効果 | ⭐⭐ | 用途に応じた最適化 |
| リスク | 低 | 既存構成と一致 |
| 実装コスト | なし | ドキュメント整備のみ |

### 判定: 🟢 採用

**理由**: 現状の推奨構成と一致。ドキュメント明確化のみ。

**実装方針**:
- 機能一覧.mdの推奨構成セクションを更新
- README.mdに明記

---

## 提案3: ActionWhitelistChecker追加

### ChatGPTの意見

> - 眼鏡・珈琲・アクセサリーなど「実際に持っていない小道具」のハルシネーション防止
> - ホワイトリスト形式で許可されたアクションのみ許容

### 現状確認

| 項目 | 状態 |
|------|------|
| ContextChecker | ✅ 有効（一般的なハルシネーション検出） |
| props検出 | ❌ 未実装 |

### 妥当性評価

| 観点 | 評価 | 理由 |
|------|------|------|
| 効果 | ⭐⭐ | 特定問題への対処 |
| リスク | 中 | ホワイトリスト管理コスト |
| 実装コスト | 中 | 新規チェッカー追加 |
| 問題頻度 | 不明 | 現時点でpropsハルシネーション発生頻度未計測 |

### 現行との比較

```
現行: ContextChecker
- 「姉妹なのに友達と呼ぶ」等の関係性ハルシネーション検出
- propsレベルの詳細チェックは未対応

提案: ActionWhitelistChecker
- 眼鏡、珈琲、アクセサリー等の小道具検出
- ホワイトリスト管理が必要
```

### 判定: 🟡 検討（問題頻度計測後に再評価）

**理由**: 問題の発生頻度が不明。先に計測が必要。

**次のアクション**:
1. 既存実験結果からpropsハルシネーション頻度を計測
2. 頻度が高ければPhase 2.3で実装検討
3. 頻度が低ければ優先度下げ

---

## 提案4: 3段階アーキテクチャ

### ChatGPTの意見

> 1. Thought生成（内面）
> 2. Action+Speech生成（外面表出）
> 3. State更新（非同期）

### 現状確認

| 項目 | 状態 |
|------|------|
| TWO_PASS | ⚡ 利用可能（Thought → Output） |
| Two-Phase Engine v4.0 | ⚡ 利用可能（Phase1 → Phase2） |
| State更新 | ❌ 未実装 |

### 妥当性評価

| 観点 | 評価 | 理由 |
|------|------|------|
| 効果 | ⭐⭐⭐ | 根本的なInstruction飽和対策 |
| リスク | 高 | 大規模設計変更 |
| 実装コスト | 高 | 新アーキテクチャ全面導入 |
| 既存検証 | 不十分 | TWO_PASSすら本番未適用 |

### 現行計画との整合性

```
現行計画:
- Phase 2.3: NoveltyGuard（話題ループ検出）
- Phase 3: RAG統合

ChatGPT提案:
- 3段階アーキテクチャ（大規模変更）

判断:
- TWO_PASSをまず本番適用し効果確認
- 問題が解決しなければ3段階を検討
```

### 判定: 🔴 保留（TWO_PASS本番適用後に再評価）

**理由**:
- TWO_PASSが未だ本番未適用
- まずTWO_PASSで十分かを確認すべき
- 3段階は「次の次」の選択肢

---

## 提案5: TWO_PASS vs Two-Phase Engine比較

### ChatGPTの意見

> TWO_PASSとTwo-Phase Engine v4.0の違いが不明確。比較実験を推奨。

### 現状確認

| 項目 | TWO_PASS | Two-Phase Engine v4.0 |
|------|----------|----------------------|
| 実装 | ✅ 完了 | ✅ 完了 |
| 効果検証 | ✅ 済 | ❓ 未検証 |
| 設計思想 | Thought→Output分離 | Phase1（最小プロンプト）→Phase2 |

### 詳細比較

| 観点 | TWO_PASS | Two-Phase Engine |
|------|----------|------------------|
| プロンプト構造 | 同一プロンプト、出力分離 | 完全分離プロンプト |
| Thought生成 | 制約あり | 制約なし（最小） |
| Output生成 | Thoughtを参照 | Thoughtを入力として注入 |
| 実装複雑度 | 低 | 中 |

### 妥当性評価

| 観点 | 評価 | 理由 |
|------|------|------|
| 効果 | ⭐⭐ | 最適な方式を選定可能 |
| リスク | 低 | 実験のみ |
| 実装コスト | 低 | 実験スクリプト作成のみ |

### 判定: 🟢 採用（比較実験実施）

**理由**: 両方実装済みなので比較コストが低い

**実装方針**:
```bash
# 比較実験スクリプト
experiments/
  ├── generation_mode_comparison.py  # TWO_PASS vs Two-Phase Engine
  └── results/
      └── generation_mode_{timestamp}/
```

---

## 現行計画との統合

### 現行ロードマップ

```
Phase 2.2 ✅ 完了: LLMベースDirector
Phase 2.3 🔲 予定: NoveltyGuard（話題ループ検出）
Phase 3  🔲 予定: RAG統合
```

### ChatGPT提案統合後

```
Phase 2.2.1 (最適化):
  ├── [採用] TWO_PASSデフォルト化
  ├── [採用] Director使い分けドキュメント整備
  └── [採用] TWO_PASS vs Two-Phase比較実験

Phase 2.3 (品質向上):
  ├── [既存] NoveltyGuard（話題ループ検出）
  └── [検討] ActionWhitelistChecker（propsハルシネーション）

Phase 3:
  └── [既存] RAG統合

将来検討:
  └── [保留] 3段階アーキテクチャ
```

---

## 次のアクション

### 即座に実行（Phase 2.2.1）

| アクション | 担当 | 優先度 |
|-----------|------|--------|
| TWO_PASSをデフォルト化 | duo-talk-core | 高 |
| Director使い分けドキュメント整備 | duo-talk-evaluation | 中 |
| TWO_PASS vs Two-Phase比較実験 | duo-talk-evaluation | 中 |

### 計測後に判断

| アクション | 条件 | 優先度 |
|-----------|------|--------|
| ActionWhitelistChecker実装 | propsハルシネーション頻度 > 5% | 中 |

### 保留

| アクション | 条件 | 優先度 |
|-----------|------|--------|
| 3段階アーキテクチャ | TWO_PASSで不十分な場合 | 低 |

---

## 関連文書

- [機能一覧.md](../../docs/機能一覧.md) - 機能一覧
- [ARCH_TWO_PHASE_GENERATION.md](./ARCH_TWO_PHASE_GENERATION.md) - 2フェーズ生成仕様

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|---------|
| 2026-01-24 | 1.0 | 初版作成（ChatGPT分析に基づく） |

---

*Source: ChatGPT分析（2026-01-24）*
