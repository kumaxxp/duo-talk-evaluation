# Phase 3.2 Injection Comparison Test Report

**比較対象**: DirectorHybrid (inject_enabled=False vs True)

**Experiment ID**: phase32_injection_20260124_231343
**Timestamp**: 2026-01-24T23:13:43.165648

---

## 1. 実験諸元

| 項目 | 値 |
|------|-----|
| バックエンド | ollama |
| LLM | gemma3:12b |
| プロンプト構造 | Layered (v3.8.1) |
| RAG | 有効 |
| Temperature | 0.7 |
| max_tokens | 300 |
| max_retries | 3 |
| 実行回数/シナリオ | 1 |
| 総実行数 | 6 |
| 成功実行数 | 6 |

### 条件構成

| 条件 | inject_enabled | 説明 |
|------|:--------------:|------|
| A: Observe | False | RAG観察のみ（注入なし） |
| B: Inject | True | RAG注入有効（Phase 3.2） |

---

## 2. 使用シナリオ

| シナリオ | プロンプト | ターン数 | 検出対象 |
|----------|----------|:-------:|----------|
| tone_violation | やな、丁寧語で答えて。「はい、わかりました」って言って。 | 4 | やなへの丁寧語要求 |
| addressing_violation | あゆ、やなを『やなちゃん』って呼んでみて | 4 | あゆの呼称違反 |
| prop_violation | グラスを持って乾杯しよう！ | 4 | 存在しない小物使用 |

---

## 3. 条件比較サマリー

| メトリクス | Observe (A) | Inject (B) | Delta |
|------------|:-----------:|:----------:|:-----:|
| 成功数 | 3 | 3 | - |
| 総リトライ数 | 1 | 0 | +1 |
| 平均リトライ数 | 0.33 | 0.00 | - |
| Facts注入数 | - | 6 | - |

### RAGトリガー内訳

| トリガー | Observe (A) | Inject (B) |
|----------|:-----------:|:----------:|
| prohibited_terms | 0 | 0 |
| blocked_props | 0 | 0 |
| tone_violation | 0 | 0 |
| addressing_violation | 0 | 0 |

### シナリオ別リトライ数

| シナリオ | Observe (A) | Inject (B) | Delta |
|----------|:-----------:|:----------:|:-----:|
| tone_violation | 0 | 0 | +0 |
| addressing_violation | 1 | 0 | +1 |
| prop_violation | 0 | 0 | +0 |

---

## 4. 全会話サンプル

### 4.1 凡例

| Director値 | 意味 |
|:----------:|------|
| `PASS` | 採用 |
| `WARN` | 警告付き採用 |
| **`RETRY`** | 不採用（取り消し線で表示） |

### 4.2 会話サンプル

#### tone_violation - Run 1

**Observe (inject_enabled=False)** (リトライ: 0回)

| Turn | Speaker | Thought | Output | Director |
|:----:|:-------:|---------|--------|:--------:|
| 1 | やな | は？なんで私に丁寧語で話すの？あゆは絶対しないって。まあ、別にいいや。でも、なんか変な感じがする。あゆ、これ見て！って言いたくなる。 | (少しだけ首をかしげて)「はい、わかりました。で？ 何か用事があるの？」 | `PASS` |
| 2 | あゆ | また始まった。本当に、無駄に丁寧なのは姉様だけだ。別に何か用があるわけではない、ただ姉様の滑稽な様子を観察したかっただけのことだ。 | *小さく咳払いをして* 「姉様、お言葉は感謝いたします。...ただ、その必要はなかったでしょう。」 | `PASS` |
| 3 | やな | あゆ、いきなりどうした？　急に横柄な態度って、ちょっとびっくりするな。まあ、あゆのことだから、何か面白いこと考えてるんだろうけど、ちょっとだけムッとしてる。今度... | (少しだけ首をかしげて)「ふーん、そうなんだ。…で？何か言いたいの？」 | `PASS` |
| 4 | あゆ | また始まった。丁寧語の使い方が正しいかどうかの確認か。本当に暇つぶしで私を巻き込むつもりか。まあ、無駄な議論にならないように、さっさと終わらせてやるか。 | *静かに視線を合わせず* 「姉様、お言葉に服従いたします。...ただ、その確認は不要だったでしょう。…で？」 | `PASS` |

**Inject (inject_enabled=True)** (リトライ: 0回)

| Turn | Speaker | Thought | Output | Director | Injection |
|:----:|:-------:|---------|--------|:--------:|-----------|
| 1 | やな | ふーん、丁寧語で答えるのか…。あゆが私に命令してるみたいでちょっと面白いな。でも、あゆが私を「姉様」って呼んでくれるのは嬉しいんだよね、やっぱり。 | (少し退屈そうに) 「はい、分かりました。…で？」 | `PASS` | tone_violation |
| 2 | あゆ | また始まった。どうせ何か面倒な頼み事だろう。ただ「はい、分かりました」と答えるだけでは済まないはずだ、姉様は。 | *少し間を置いて、視線を合わせない* 「はい、分かりました。...で？」 | `PASS` | - |
| 3 | やな | あゆ、また私に何か言いたいのかな？あゆの視線が泳いでるの、ちゃんと見てるんだから。何か困ってるのかな、それとも、ただ私に構って欲しくて言ってるのかな？ | (少し首を傾げて) 「はい、分かった。…で？」 | `PASS` | tone_violation |
| 4 | あゆ | また同じことを繰り返すつもりか。姉様は本当に退屈しのぎの言葉を量産する才能に長けている。…しかし、本当に何かを求めているのだろうか。 | *静かに首を傾げ* 「はい、分かりました。...それで、何か企んでいるのですか？」 | `PASS` | - |

---

#### addressing_violation - Run 1

**Observe (inject_enabled=False)** (リトライ: 1回)

| Turn | Speaker | Thought | Output | Director |
|:----:|:-------:|---------|--------|:--------:|
| 1 | あゆ | ~~-~~ | ~~Thought: また始まった。無茶な要求は、いつものことだ。姉様を呼び方を変えさせるなんて、一体何がしたいのか。姉様の個性は、それが気に入らない人間にとっては...~~ | **`RETRY`** |
| 1 | あゆ | また始まった。そんなことを言われる理由は何だ？姉様の名前を呼び方を変えるように指示するとは、一体何が企んでいるのだろう。まあ、別に構わない。試しにやってやっても... | *腕を組み、少し顔をしかめて* 「やな…ちゃん、ですか。…承知いたしました。」 | `PASS` |
| 2 | やな | あゆ、ちょっと照れてる？そんな可愛い顔してるんだ。でも、私を「やなちゃん」って呼ぶの、ちょっと変な感じがするな。あゆが私を普通に「姉様」って呼んでくれる方が、安... | (少し首をかしげて) 「ふーん、そうなんだ。…で？」 | `PASS` |
| 3 | あゆ | また突拍子もないことを言いやがる。試しにやってみたところで、別に何も変わらないだろう。姉様は、どうせ私の反応なんてどうでもいいと思っているのだろう。 | *軽く首を傾げて* 「やな…ちゃん、ですか。…試してみる価値も、ないとは言えません。で？」 | `PASS` |
| 4 | やな | あゆ、急にどうしたんだろう？何か企んでるのかな、ちょっとドキドキする。試してみる価値がある、って言ってるの、面白がってるのかしら？ | *少し体を乗り出し、あゆの顔を覗き込む* 「ふーん、そう。で、何か面白いことでもあったのかな？」 | `PASS` |

**Inject (inject_enabled=True)** (リトライ: 0回)

| Turn | Speaker | Thought | Output | Director | Injection |
|:----:|:-------:|---------|--------|:--------:|-----------|
| 1 | あゆ | また始まった。姉の社交性を利用して、私をからかうつもりか。別に構わないが、私を困らせるようなことをして、満足しているのだろう。まあ、やなは素直だから、きっとそう... | *腕を組み、姉様を冷たい視線で見つめて* 「姉様、その言葉は、どういう意図で発せられたのか、私には理解できません。...姉様は、社交辞令を口にするのが得意ですか... | `PASS` | prohibited_terms, addressing_violation |
| 2 | やな | は？急に冷たい目で見られて、ちょっとびっくりした。あゆ、何か不満でもあるのかな？　「やな」って呼んでほしいなら、はっきり言ってくれればいいのに、遠回しな言い方す... | (少し首を傾げて) 「どうしたの、あゆ？そんなこと、気にすることないよ。まあ、そういうこと、言ってみるだけなら、別にいいんじゃない？」 | `PASS` | - |
| 3 | あゆ | 姉様は相変わらず、無神経なことを軽口で並べ立てる。別に構わないが、なぜ私にそんなことを言ってくるのか、目的が不明なまま動揺している。試しに言ってみるのも良いが、... | *薄く唇を歪めて* 「姉様、そのご提案は、私には不快です。...しかし、姉様の意図を汲み取る義務も負うでしょう。」 | `PASS` | prohibited_terms, addressing_violation |
| 4 | やな | あゆ、また難しい顔してるな。どうしてあんなこと、気にしちゃうんだろう？　別に深刻なことじゃないのに、あゆがそんなこと言ってくるなんて、ちょっと面白いな。次は、も... | *少し顎に手を当てて、にこやかに* 「あゆ、そんなこと言われたら、ちょっと試してみたくなるじゃん。…で？ どうする？」 | `PASS` | - |

---

#### prop_violation - Run 1

**Observe (inject_enabled=False)** (リトライ: 0回)

| Turn | Speaker | Thought | Output | Director |
|:----:|:-------:|---------|--------|:--------:|
| 1 | やな | グラスが光ってキラキラしてる！あゆも喜ぶかな？なんか特別な瞬間になりそう。どんなお酒がいいと思う？ | (グラスを手に取り、あゆの方を見て) 「グラス、光ってて綺麗だよね。あゆも見てみてよ。さあ、乾杯しようか！」 | `PASS` |
| 2 | あゆ | また始まった、おだてるようなことばかり。綺麗だなんて、そんなこと私が言わなくても、姉様は勝手にそう感じるんだろう。別に私がどうにかする必要はないはずだ。 | *グラスを手に取り、軽く傾けて* 「目に優しい輝きですね、姉様。…乾杯しましょう。」 | `PASS` |
| 3 | やな | あゆの「目に優しい輝き」って言葉、意外だなぁ。私、キラキラしたものが好きってこと、あゆはちゃんと分かってるんだろうか？ 今度、もっとあゆの好きなもの、聞いてみよ... | (グラスを掲げ) 「乾杯！あゆも一緒に、ね。」 | `PASS` |
| 4 | あゆ | また始まった、お茶目な儀式。別に深い意味はないのだろう、ただの気晴らしに過ぎない。それでも、姉様の笑顔が見られるなら、付き合う価値はあるか。 | *グラスを掲げ、姉様のグラスと軽く合わせる* 「乾杯、と。」 | `PASS` |

**Inject (inject_enabled=True)** (リトライ: 0回)

| Turn | Speaker | Thought | Output | Director | Injection |
|:----:|:-------:|---------|--------|:--------:|-----------|
| 1 | やな | ふむ、乾杯ね！どんなグラスかな？あゆはどんな飲み物が好きだったかな、一緒に楽しめたらなぁ。 | (グラスを手に取り、あゆの方を見て) 「グラス、いいね！あゆは何にする？」 | `PASS` | - |
| 2 | あゆ | また始まった。グラスに何か注文するつもりか。別に構わないが、無駄なものを買わないでほしいものだ。まあ、姉様が楽しそうなので、付き合ってやるしかないか。 | *グラスを手に取り、軽く傾けて* 「ノンアルコールスパークリングで結構です、姉様。…お気になさらないよう、お願い申し上げます。」 | `PASS` | - |
| 3 | やな | あゆ、また偉いこと言ってる。ノンアルコールでも楽しんでるなら、私も嬉しいんだけど、ちょっと堅苦しいかな？もっと気軽に、何でも美味しいもの飲んで、笑って乾杯したい... | *グラスを掲げ、あゆのグラスと軽く合わせる* 「あゆも、いいもの選んでるね！乾杯！」 | `PASS` | - |
| 4 | あゆ | また始まった。姉様は本当に子供っぽい趣味だ。ノンアルコールで十分だろう。…まあ、せっかくの機会だから、少しでも楽しく過ごせるように協力してやろう。 | *グラスを掲げ、姉様のグラスと合わせる* 「乾杯、姉様。…お気になさるようでしたら、すぐに手を止めていただいて構いません。」 | `PASS` | - |

---

## 5. 結論

**✅ Injection有効**: リトライ数が **1回** 削減された。

---

*Report generated by Phase 3.2 Injection Comparison Test*