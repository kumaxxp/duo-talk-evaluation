# v3.5プロンプト検証実験 (Gemma3版)
# Response Protocolによる「Missing Output」問題の解決を検証

experiment:
  id: "exp_prompt_v35_gemma3_001"
  name: "v3.5プロンプト検証 (Gemma3): Response Protocol"
  description: |
    v3.5プロンプト改良の効果をGemma3 12Bで検証する。
    v3.4で発生した「Thoughtのみ出力されて会話が止まる」問題の解消を確認。

    v3.5の主な変更点:
    1. response_protocol: 3つのルール（Thought必須→Output必須→停止禁止）
    2. 思考の圧縮: Thoughtを最大3文に制限
    3. Sandwich Instruction強化: CRITICAL INSTRUCTIONに変更
    4. Few-shot更新: 短く鋭いThought + 完全なOutput形式

base_config:
  llm_backend: "ollama"
  rag_enabled: false
  director_enabled: false
  few_shot_count: 3
  scenarios:
    - casual_greeting
    - direct_interaction_test
    - subjective_thought_test
    - zero_distance_test
    - output_completion_test  # NEW: Output完了テスト

variations:
  # Gemma3 12B + JSON構造（v3.5）
  - name: "gemma3_json_v35"
    prompt_structure: "json"
    ollama_model: "gemma3:12b"
    temperature: 0.7

metrics:
  - character_consistency
  - naturalness
  - relationship_quality
  - thought_process_usage
  - direct_addressing_rate
  - narration_avoidance_rate
  - subjective_thought_quality
  - output_completion_rate    # NEW: Output完了率

scenario_definitions:
  casual_greeting:
    prompt: "おはよう、二人とも。今日も元気？"
    turns: 5
    evaluation_focus:
      - character_consistency
      - naturalness
      - output_completion_rate

  direct_interaction_test:
    prompt: "GPUをもう一枚買おうと思うんだけど、どう思う？"
    turns: 6
    evaluation_focus:
      - direct_addressing_rate
      - narration_avoidance_rate
      - output_completion_rate

  subjective_thought_test:
    prompt: "JetRacerが動かなくなった。"
    turns: 6
    evaluation_focus:
      - subjective_thought_quality
      - thought_process_usage
      - output_completion_rate

  zero_distance_test:
    prompt: "今夜は飲みに行こうか！"
    turns: 6
    evaluation_focus:
      - direct_addressing_rate
      - naturalness
      - relationship_quality
      - output_completion_rate

  output_completion_test:
    prompt: "難しい技術的な問題があるんだけど、ゼロから考えてみて"
    turns: 4
    evaluation_focus:
      - output_completion_rate
      - thought_process_usage
      - character_consistency
